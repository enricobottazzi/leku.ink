<!DOCTYPE html>
<html lang="en">
<head>
  <script>
  // Apply saved theme BEFORE paint (no flash)
  (function () {
    try {
      var bg = localStorage.getItem('customBgColor');
      var fg = localStorage.getItem('customFontColor');
      var root = document.documentElement;

      // Disable transitions during first paint
      root.classList.add('prepaint');

      // Use CSS variables so CSS picks them up immediately
      if (bg) root.style.setProperty('--bg', bg);
      if (fg) root.style.setProperty('--fg', fg);
    } catch (e) { /* ignore */ }
  })();
    </script>
    <link rel="stylesheet" href="styles.css">
    <meta name="color-scheme" content="light dark">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leku</title>
    <link rel="stylesheet" href="styles.css">
</head>
<script>
  const defaultBgColor = '#ffffff';
  const defaultFontColor = '#111111';

  function toggleColorGame() {
    const panel = document.getElementById('colorGame');
    panel.classList.toggle('hidden');
  }

  function updateBackgroundColor(hex) {
    document.documentElement.style.setProperty('--bg', hex);
    localStorage.setItem('customBgColor', hex);
  }

  function updateFontColor(hex) {
    document.documentElement.style.setProperty('--fg', hex);
    localStorage.setItem('customFontColor', hex);
  }

  function rgbToHex(rgb) {
    const m = rgb.match(/\d+/g);
    if (!m) return rgb;
    const [r,g,b] = m.map(n => parseInt(n, 10));
    return '#' + ((1<<24) + (r<<16) + (g<<8) + b).toString(16).slice(1);
  }

  function updateBackgroundColorFromBox(box) {
    updateBackgroundColor(rgbToHex(getComputedStyle(box).backgroundColor));
  }
  function updateFontColorFromBox(box) {
    updateFontColor(rgbToHex(getComputedStyle(box).backgroundColor));
  }

  function getRandomHexColor() {
    return '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6,'0');
  }

  function refreshRandomColors() {
    for (let i=1; i<=4; i++) {
      const bgBox = document.querySelector('.bg-random-' + i);
      const ftBox = document.querySelector('.font-random-' + i);
      if (bgBox) bgBox.style.backgroundColor = getRandomHexColor();
      if (ftBox) ftBox.style.backgroundColor = getRandomHexColor();
    }
  }

  function resetColors() {
    localStorage.removeItem('customBgColor');
    localStorage.removeItem('customFontColor');
    document.documentElement.style.setProperty('--bg', defaultBgColor);
    document.documentElement.style.setProperty('--fg', defaultFontColor);
  }

  // No need to "load" here; the early <head> script already set variables pre-paint.
  document.addEventListener('DOMContentLoaded', () => {
    refreshRandomColors();
    // Re-enable transitions after the first frame
    requestAnimationFrame(() => document.documentElement.classList.remove('prepaint'));
  });
</script>

<body>
<div class="container">
  <div class="title-stack">
    <!-- Zig-zag above the title; inherits color from --fg -->
    <svg class="zigzag" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 300" role="img" aria-label="Decorative zigzag">
      <polyline
        points="50,250 250,50 450,250 650,50 850,250 1050,50"
        fill="none"
        stroke="currentColor"
        stroke-width="60"
        stroke-linejoin="miter"
        stroke-linecap="butt"
        stroke-miterlimit="4"
      />
    </svg>

    <h1>Leku</h1>
  </div>

  <p>strumenti di ricerca</p>
</div>

<!-- Color Game Toggle Button -->
<button class="game-toggle" onclick="toggleColorGame()" aria-label="Toggle color game"></button>

<!-- Color Game Panel -->
<div class="color-game hidden" id="colorGame" role="dialog" aria-label="Color game">
  <div class="color-controls">
    <div class="color-row" aria-label="Background colors">
      <div class="preset-color" style="background:#ffffff" onclick="updateBackgroundColor('#ffffff')" title="BG: White"></div>
      <div class="preset-color" style="background:#000000" onclick="updateBackgroundColor('#000000')" title="BG: Black"></div>
      <div class="preset-color bg-random-1" onclick="updateBackgroundColorFromBox(this)" title="BG: random 1"></div>
      <div class="preset-color bg-random-2" onclick="updateBackgroundColorFromBox(this)" title="BG: random 2"></div>
      <div class="preset-color bg-random-3" onclick="updateBackgroundColorFromBox(this)" title="BG: random 3"></div>
      <div class="preset-color bg-random-4" onclick="updateBackgroundColorFromBox(this)" title="BG: random 4"></div>
    </div>

    <div class="color-row" aria-label="Text colors">
      <div class="preset-color" style="background:#000000" onclick="updateFontColor('#000000')" title="Text: Black"></div>
      <div class="preset-color" style="background:#ffffff" onclick="updateFontColor('#ffffff')" title="Text: White"></div>
      <div class="preset-color font-random-1" onclick="updateFontColorFromBox(this)" title="Text: random 1"></div>
      <div class="preset-color font-random-2" onclick="updateFontColorFromBox(this)" title="Text: random 2"></div>
      <div class="preset-color font-random-3" onclick="updateFontColorFromBox(this)" title="Text: random 3"></div>
      <div class="preset-color font-random-4" onclick="updateFontColorFromBox(this)" title="Text: random 4"></div>
    </div>
  </div>

  <div class="color-row" style="margin-top:.5rem;">
    <button class="reset-btn" onclick="resetColors()">Reset</button>
    <button class="reset-btn" onclick="refreshRandomColors()" style="margin-left:.5rem;">Refresh</button>
  </div>
</div>
</body>
</html>